/** @format */

const request = require('supertest');
const server = require('../api/server');
const db = require('../database/dbConfig');
describe('User List tests', () => {
	const mike = { username: 'Mike', password: 'McLeod', role: 1 };
	const baker = { username: 'Baker', password: 'cookies', role: 2 };
	const trabin = { username: 'Trabin', password: 'toast', role: 1 };

	it('User list - Mike', async () => {
		await request(server)
			.post('api/auth/register')
			.send(mike)
			.then(async () => {
				await request(server)
					.post('/api/auth/login')
					.send(mike)
					.then((res) => expect(res.body).toHaveProperty('token'))
					.then(async () => {
                        await request(server)
                        .get('/api/users')
                        .expect(200);
					})
					.catch((error) => console.log(error));
			});
	});

	it('User list', async () => {
		await request(server)
			.post('api/auth/register')
			.send(baker)
			.then(async () => {
				await request(server)
					.post('/api/auth/login')
					.send(baker)
					.then((res) => expect(res.body).toHaveProperty('token'))
					.then(async () => {
                        await request(server)
                        .get('/api/users')
                        .expect(401);
					})
					.catch((error) => console.log(error));
			});
	});

	it('User list', async () => {
		await request(server)
			.post('api/auth/register')
			.send(trabin)
			.then(async () => {
				await request(server)
					.post('/api/auth/login')
					.send(trabin)
					.then((res) => expect(res.body).toHaveProperty('token'))
					.then(async () => {
                        await request(server)
                        .get('/api/users')
                        .expect(200);
					})
					.catch((error) => console.log(error));
			});
	});
});
